<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spell Tester</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <a href="home.html"><button id="closebtn">End</button></a>
    <div id="status">
        <h3>Score: <span id="score"></span></h3>
    </div>
    <h2 style="color: rgb(69, 222, 100);"> Spell Tester</h2>
    <button id="repeat" onclick="repeatbtn()">ðŸ”ˆ</button><br>
    <input id="userinput"><br>
    <button id="submition">Submit</button>
    <h2 id="correction"></h2>
    <script>
let score = 0
let pletters = []
let txt

let randomnum
let userinput = document.getElementById('userinput').value
let wrong = 0
let right = 0

function getPreferredVoice() {
    const voices = window.speechSynthesis.getVoices();
    const preferredVoices = ['Samantha',];
    
    for (let preferred of preferredVoices) {
        const voice = voices.find(v => v.name.includes(preferred));
        if (voice) return voice;
    }

    const femaleVoice = voices.find(v => 
        v.name.toLowerCase().includes('female') || 
        v.name.toLowerCase().includes('woman') ||
        v.gender === 'female'
    );
    if (femaleVoice) return femaleVoice;
    return voices[0] || null;
}
function speak(text, pitch = 0.3, rate = 0.3) {
    const utterance = new SpeechSynthesisUtterance(text);
    const voice = getPreferredVoice();
    
    if (voice) {
        utterance.voice = voice;
    }
    
    utterance.pitch = pitch
    utterance.rate = rate
    utterance.volume = 1.0
    utterance.lang = 'en-US'
    window.speechSynthesis.speak(utterance)
}


if (window.speechSynthesis.getVoices().length === 0) {
    window.speechSynthesis.addEventListener('voiceschanged', function() {
        getword()
    })
} else {
    getword()
}


    document.getElementById('submition').addEventListener('click', function() {
        let userinput = document.getElementById('userinput').value
        if (userinput === pletters) { 
            score += 5
            txt = "Correct, Great Job! ,"
            speak(txt, 0.8, 0.8)
            document.getElementById('correction').style.color = 'rgba(60, 200, 88, 1)'
            document.getElementById('correction').textContent = "Great Job!"
            getword()
           
        } else {
            txt = "Almost there! Try again! ,"
            document.getElementById('correction').textContent = "Last missed question: "+ pletters
            document.getElementById('correction').style.color = 'rgba(225, 43, 43, 1)'
            speak(txt, 0.8, 0.8)
            getword() 
        }
    })

async function getword() {
    const response = await fetch('https://random-word-api.herokuapp.com/word?length=7')
    const data = await response.json()
    pletters = data[0]
    speak(pletters, 0.8, 0.8)
    console.log(pletters)
}
    


function repeatbtn() {
    txt = String(pletters)
    speak(txt, 0.8, 0.8)
}


document.getElementById('userinput').addEventListener('click', function() {
    document.getElementById('userinput').value = ''
})


window.onload = function() {
    let mode = localStorage.getItem("mode")

     if (mode === "dark") {
        document.body.style.backgroundColor = 'black'
    } else if (mode === "light"){
        document.body.style.backgroundColor = 'white'
    }
}

</script>
</body>
</html>
